server:
  port: 8080

# Второй коннектор: HTTPS на 8443 (keystore монтируется в /home/user/gateway-certs/ в Docker)
gateway:
  ssl:
    enabled: true
    port: 8443
    keystore-path: /home/user/gateway-certs/gateway.p12
    keystore-password: ${GATEWAY_SSL_KEYSTORE_PASSWORD:changeit}

# Список доменов для прозрачного прокси (через роутер DNAT). Строка для предиката Host и фильтра.
# Для каждого домена добавлены варианты с :443 и :8443, чтобы запросы с Host: host:port тоже матчились
# (иначе запросы к googlevideo.com и др. с портом в Host не попадают на transparent-proxy-route).
proxy:
  domains: "**.youtube.com,**.youtube.com:443,**.youtube.com:8443,**.youtube-nocookie.com,**.youtube-nocookie.com:443,**.youtube-nocookie.com:8443,**.googlevideo.com,**.googlevideo.com:443,**.googlevideo.com:8443,**.instagram.com,**.instagram.com:443,**.instagram.com:8443,**.netflix.com,**.netflix.com:443,**.netflix.com:8443,**.nflxvideo.net,**.nflxvideo.net:443,**.nflxvideo.net:8443,api.openai.com,api.openai.com:443,api.openai.com:8443,**.openai.com,**.openai.com:443,**.openai.com:8443,**.mastodon.social,**.mastodon.social:443,**.mastodon.social:8443,**.mastodon.*,**.mastodon.*:443,**.mastodon.*:8443,**.ytimg.com,**.ytimg.com:443,**.ytimg.com:8443,**.ggpht.com,**.ggpht.com:443,**.ggpht.com:8443,**.gstatic.com,**.gstatic.com:443,**.gstatic.com:8443,**.googleapis.com,**.googleapis.com:443,**.googleapis.com:8443,**.telegram.org,**.telegram.org:443,**.telegram.org:8443,**.t.me,**.t.me:443,**.t.me:8443"
  upstream:
    enabled: false
    type: HTTP
    host: proxy.example.com
    port: 3128
    # username: ${PROXY_USER:}
    # password: ${PROXY_PASSWORD:}

spring:
  application:
    name: gateway-openai-api
  cloud:
    gateway:
      routes:
        - id: openai-route
          uri: https://api.openai.com/v1
          predicates:
            - Path=/openai/**
          filters:
            - StripPrefix=1
#            - name: OpenAiAuthFilter

        - id: transparent-proxy-route
          uri: https://proxy-placeholder.invalid
          predicates:
            - Host=${proxy.domains}
          filters:
            - PreserveHostHeader

      # Глобальные настройки CORS или другие глобальные фильтры

      globalcors:
        corsConfigurations:
          "[/**]":
            allowedOrigins: "*"
            allowedHeaders: "*"
            allowedMethods: "*"
            maxAge: 3600

logging:
  level:
    root: INFO
    # Логгирование Spring Cloud Gateway (для отладки можно включить DEBUG или TRACE)
    org.springframework.cloud.gateway: DEBUG
    # Логгирование WebFlux / Reactor Netty, если нужно отследить запросы на низком уровне
    reactor.netty: INFO

